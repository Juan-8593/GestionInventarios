<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Productos - Gesti√≥n de Inventarios</title>
    <link rel="stylesheet" href="css/productos.css">
    <style>
        /* Filtros con mismo ‚Äúlook‚Äù que el form de alta */
        .toolbar {
            margin-bottom:12px;
            display:flex;
            gap:8px;
            flex-wrap:wrap;
        }
        .toolbar input, .toolbar button {
            padding:8px;
            border-radius:6px;
            border:1px solid #ccc;
        }
    </style>
</head>
<body>
<header>
    <h1>Productos</h1>
    <nav class="menu">
        <button onclick="location.href='index.html'">Dashboard</button>
        <button onclick="location.href='categorias.html'">Categor√≠as</button>
        <button onclick="location.href='movimientos.html'">Movimientos</button>
    </nav>
</header>

<section>
    <!-- üîé Filtros (agregado, incluye Catego0oor√≠a) -->
    <form id="formFiltro" class="toolbar">
        <input type="text" name="id" placeholder="ID" style="max-width:110px;">
        <input type="text" name="nombre" placeholder="Nombre">
        <input type="text" name="descripcion" placeholder="Descripci√≥n">
        <input type="text" name="categoria" placeholder="Categor√≠a"><!-- NUEVO -->
        <input type="number" name="precioMin" placeholder="Precio min" step="0.01" min="0" style="max-width:140px;">
        <input type="number" name="precioMax" placeholder="Precio m√°x" step="0.01" min="0" style="max-width:140px;">
        <input type="number" name="stockMin" placeholder="Stock min" min="0" style="max-width:120px;">
        <input type="number" name="stockMax" placeholder="Stock m√°x" min="0" style="max-width:120px;">
        <button type="submit">Buscar</button>
        <button type="button" id="btnLimpiar">Limpiar</button>
    </form>

    <!-- ‚ûï Alta (igual que ten√≠as; solo a√±ad√≠ campo de Categor√≠a para poder llenarla) -->
    <form id="formProducto">
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="descripcion" placeholder="Descripci√≥n">
        <input type="text" name="categoria" placeholder="Categor√≠a"><!-- NUEVO -->
        <input type="number" name="precio" placeholder="Precio" min="0" step="0.01" required>
        <input type="number" name="stock" placeholder="Stock" min="0" required>
        <button type="submit">Agregar Producto</button>
    </form>

    <table id="tablaProductos">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Descripci√≥n</th>
            <th>Categor√≠a</th><!-- NUEVO -->
            <th>Precio</th>
            <th>Stock</th>
            <th>Acciones</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const tabla = document.querySelector("#tablaProductos tbody");
        const form = document.getElementById("formProducto");
        const formFiltro = document.getElementById("formFiltro");
        let productos = JSON.parse(localStorage.getItem("productos")) || [];

        function guardar() {
            localStorage.setItem("productos", JSON.stringify(productos));
            cargarTabla();
        }

        // Aplica filtros sin modificar la lista
        function filtrar(lista) {
            const f = Object.fromEntries(new FormData(formFiltro));
            return lista.filter(p => {
                if (f.id && String(p.id) !== String(f.id)) return false;
                if (f.nombre && !(p.nombre || '').toLowerCase().includes(f.nombre.toLowerCase())) return false;
                if (f.descripcion && !(p.descripcion || '').toLowerCase().includes(f.descripcion.toLowerCase())) return false;
                if (f.categoria && !(p.categoria || '').toLowerCase().includes(f.categoria.toLowerCase())) return false; // NUEVO
                if (f.precioMin && Number(p.precio) < Number(f.precioMin)) return false;
                if (f.precioMax && Number(p.precio) > Number(f.precioMax)) return false;
                if (f.stockMin && Number(p.stock) < Number(f.stockMin)) return false;
                if (f.stockMax && Number(p.stock) > Number(f.stockMax)) return false;
                return true;
            });
        }

        function cargarTabla() {
            tabla.innerHTML = "";
            const lista = filtrar(productos);

            if (lista.length === 0) {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td colspan="7" style="text-align:center;">Sin resultados</td>`;
                tabla.appendChild(tr);
                return;
            }

            lista.forEach(p => {
                const fila = document.createElement("tr");
                fila.innerHTML = `
                <td>${p.id}</td>
                <td>${p.nombre}</td>
                <td>${p.descripcion || ''}</td>
                <td>${p.categoria || ''}</td><!-- NUEVO -->
                <td>${Number(p.precio).toFixed(2)}</td>
                <td>${p.stock}</td>
                <td>
                    <button class="eliminar" data-id="${p.id}">Eliminar</button>
                </td>
            `;
                tabla.appendChild(fila);
            });
        }

        form.addEventListener("submit", e => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(form));
            const id = productos.length > 0 ? productos[productos.length-1].id + 1 : 1;
            productos.push({
                id: id,
                nombre: data.nombre,
                descripcion: data.descripcion,
                categoria: data.categoria || "", // NUEVO
                precio: parseFloat(data.precio),
                stock: parseInt(data.stock),
                fecha: new Date()
            });
            guardar();
            form.reset();
        });

        tabla.addEventListener("click", e => {
            if(e.target.classList.contains("eliminar")){
                const id = parseInt(e.target.dataset.id);
                productos = productos.filter(p => p.id !== id);
                guardar();
            }
        });


        formFiltro.addEventListener("submit", e => {
            e.preventDefault();
            cargarTabla();
        });
        document.getElementById("btnLimpiar").addEventListener("click", () => {
            formFiltro.reset();
            cargarTabla();
        });

        cargarTabla();
    });
</script>
</body>
</html>
