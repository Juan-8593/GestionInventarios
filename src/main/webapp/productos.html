<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Productos - Gestión de Inventarios</title>
<body>

<header>
    <h1>📦 Productos</h1>
    <nav class="menu">
        <button onclick="location.href='index.html'">Dashboard</button>
        <button onclick="location.href='categorias.html'">Categorías</button>
        <button onclick="location.href='movimientos.html'">Movimientos</button>
    </nav>
</header>

<section>
    <form id="formProducto">
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="descripcion" placeholder="Descripción">
        <input type="number" name="precio" placeholder="Precio" min="0" step="0.01" required>
        <input type="number" name="stock" placeholder="Stock" min="0" required>
        <button type="submit">Agregar Producto</button>
    </form>

    <table id="tablaProductos">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio</th>
            <th>Stock</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const contextPath = window.location.pathname.split('/')[1]; // Ajusta el contexto
        const tabla = document.querySelector("#tablaProductos tbody");
        const form = document.querySelector("#formProducto");

        // Función para cargar productos en la tabla
        function cargarProductos() {
            fetch(`/${contextPath}/productos`)
                .then(resp => resp.json())
                .then(data => {
                    if(!tabla) return;
                    tabla.innerHTML = "";
                    data.forEach(p => {
                        const fila = document.createElement("tr");
                        fila.innerHTML = `
                        <td>${p.id}</td>
                        <td>${p.nombre}</td>
                        <td>${p.descripcion}</td>
                        <td>${p.precio.toFixed(2)}</td>
                        <td>${p.stockActual}</td>
                    `;
                        tabla.appendChild(fila);
                    });
                });
        }

        // Enviar nuevo producto
        if(form){
            form.addEventListener("submit", e => {
                e.preventDefault();
                const formData = new FormData(form);
                fetch(`/${contextPath}/productos`, {
                    method: 'POST',
                    body: new URLSearchParams(formData)
                })
                    .then(resp => resp.text())
                    .then(msg => {
                        alert(msg);
                        form.reset();
                        cargarProductos();
                    });
            });
        }

        // Inicializar tabla
        cargarProductos();
    });
</script>

</body>
</html>
